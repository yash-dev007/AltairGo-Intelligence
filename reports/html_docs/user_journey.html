
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Journey</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 210mm;
            margin: 40px auto;
            padding: 40px;
            background: #fff;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        h2 { color: #2980b9; margin-top: 30px; }
        h3 { color: #16a085; }
        
        /* Tables */
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; color: #333; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        
        /* Code Blocks */
        pre { background: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; border: 1px solid #ddd; }
        code { font-family: 'Consolas', 'Monaco', monospace; color: #d63384; }
        pre code { color: #333; }
        
        /* Alerts */
        .alert { padding: 15px; border-radius: 4px; margin: 20px 0; border-left: 5px solid; }
        .alert-note { background-color: #e3f2fd; border-color: #2196f3; }
        .alert-tip { background-color: #e8f5e9; border-color: #4caf50; }
        .alert-warning { background-color: #fff3e0; border-color: #ff9800; }
        .alert-important { background-color: #f3e5f5; border-color: #9c27b0; }
        
        /* Mermaid */
        .mermaid { text-align: center; margin: 30px 0; }
        
        /* Print */
        @media print {
            body { box-shadow: none; margin: 0; padding: 0; width: 100%; max-width: 100%; }
            .no-print { display: none; }
        }
    </style>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
<h1>User Journey Map (Interaction Specifications)</h1>
<div class="alert alert-note">
This document details the exact **Finite State Machine (FSM)** of the user interaction, including Happy Paths, Empty Paths, and Error States.

</div>
<h2>1. The Interaction Graph</h2>
<p>The entire application flow can be modeled as a directed graph.</p>
<div class="mermaid">stateDiagram-v2
    [*] --&gt; Homepage

    Homepage --&gt; TripPlanner : Click &quot;Plan Trip&quot;
    Homepage --&gt; DestinationGrid : Click &quot;Explore&quot;
    Homepage --&gt; SearchResults : Type Query

    state TripPlanner {
        [*] --&gt; Step1_Country
        Step1_Country --&gt; Step2_Region : Select Valid Country
        Step2_Region --&gt; Step3_Destinations : Select Region

        state Step3_Destinations {
            [*] --&gt; CheckCache
            CheckCache --&gt; ShowCards : Cache Hit
            CheckCache --&gt; LazyLoad : Cache Miss
            LazyLoad --&gt; ShowCards : API Success
            LazyLoad --&gt; ErrorState : API Fail
        }

        Step3_Destinations --&gt; Step4_Itinerary : Generate Plan
    }
</div>
<h2>2. Detailed "Happy Path" (The 90% Case)</h2>
<p><strong>User</strong>: New Visitor.<br />
<strong>Goal</strong>: Plan a trip to <strong>Kyoto</strong>.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Interaction</th>
<th style="text-align: left;">System Internal State</th>
<th style="text-align: left;">UI Response</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1</strong></td>
<td style="text-align: left;">Click "Plan Trip"</td>
<td style="text-align: left;"><code>step: 1</code></td>
<td style="text-align: left;">Scroll to Top. Show Country Grid.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2</strong></td>
<td style="text-align: left;">Select "Japan"</td>
<td style="text-align: left;"><code>selectedCountry: "jp"</code></td>
<td style="text-align: left;">Button "Next Step" Enabled.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3</strong></td>
<td style="text-align: left;">Click "Next"</td>
<td style="text-align: left;"><code>step: 2</code></td>
<td style="text-align: left;">Fetch <code>regions</code> filtered by <code>country="jp"</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4</strong></td>
<td style="text-align: left;">Select "Kyoto"</td>
<td style="text-align: left;"><code>selectedStates: ["Kyoto"]</code></td>
<td style="text-align: left;">Card Border turns Blue. Checkmark appears.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5</strong></td>
<td style="text-align: left;">Click "Next"</td>
<td style="text-align: left;"><code>step: 3</code></td>
<td style="text-align: left;"><strong>CRITICAL</strong>: Checks <code>destinations</code> DB for <code>location="Kyoto"</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>6</strong></td>
<td style="text-align: left;"><strong>(Cache Hit)</strong></td>
<td style="text-align: left;"><code>loading: false</code></td>
<td style="text-align: left;">Show 12 cards immediately.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>7</strong></td>
<td style="text-align: left;">Select 3 Spots</td>
<td style="text-align: left;"><code>selectedDestinations: [101, 102, 103]</code></td>
<td style="text-align: left;">"Generate AI Plan" Enabled.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>8</strong></td>
<td style="text-align: left;">Click "Generate"</td>
<td style="text-align: left;"><code>step: 4</code>, <code>loading: true</code></td>
<td style="text-align: left;">Spinner "Consulting AI Agent...".</td>
</tr>
<tr>
<td style="text-align: left;"><strong>9</strong></td>
<td style="text-align: left;"><strong>(Success)</strong></td>
<td style="text-align: left;"><code>itinerary: [...]</code></td>
<td style="text-align: left;">Show Day-by-Day View + Budget Alert.</td>
</tr>
</tbody>
</table>
<h2>3. The "Empty Path" (Lazy Loading Edge Case)</h2>
<p><strong>User</strong>: Explorer.<br />
<strong>Goal</strong>: Plan a trip to <strong>"Aomori"</strong> (Empty Region).</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Interaction</th>
<th style="text-align: left;">System Internal State</th>
<th style="text-align: left;">UI Response</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1-4</strong></td>
<td style="text-align: left;">Same as above</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5</strong></td>
<td style="text-align: left;">Click "Next"</td>
<td style="text-align: left;"><code>step: 3</code></td>
<td style="text-align: left;"><strong>CRITICAL</strong>: Checks DB. Count = 0.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>6</strong></td>
<td style="text-align: left;"><strong>(Cache Miss)</strong></td>
<td style="text-align: left;"><code>fetchingRegion: true</code></td>
<td style="text-align: left;"><strong>UI TRANSITION</strong>: Radar Animation overlay appears.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>7</strong></td>
<td style="text-align: left;"><strong>Background</strong></td>
<td style="text-align: left;"><code>POST /regions/aomori/populate</code></td>
<td style="text-align: left;">Text: "Scanning Satellite Data for Aomori..."</td>
</tr>
<tr>
<td style="text-align: left;"><strong>8</strong></td>
<td style="text-align: left;"><strong>(API Success)</strong></td>
<td style="text-align: left;"><code>destinations.push(...newItems)</code></td>
<td style="text-align: left;">Animation fades out. New cards slide in.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>9</strong></td>
<td style="text-align: left;"><strong>User sees</strong></td>
<td style="text-align: left;">New cards tagged "New"</td>
<td style="text-align: left;">User continues normally.</td>
</tr>
</tbody>
</table>
<h2>4. Error States &amp; Recovery</h2>
<h3>A. The "Offline" Scenario</h3>
<ul>
<li><strong>Trigger</strong>: User clicks "Generate Plan" but Backend is down.</li>
<li><strong>System Action</strong>: <code>fetch()</code> throws <code>NetworkError</code>.</li>
<li><strong>UI Response</strong>:<br />
    &gt; [!WARNING]<br />
    &gt; <strong>Toast</strong>: "Connection to AI Backend failed. Please ensure the Python server is running."</li>
<li><strong>Recovery</strong>: User must restart server/check connection and click "Retry".</li>
</ul>
<h3>B. The "No Search Results" Scenario</h3>
<ul>
<li><strong>Trigger</strong>: User types "Mars" in Search Bar.</li>
<li><strong>System Action</strong>: Nominatim returns <code>[]</code>.</li>
<li><strong>UI Response</strong>:<ul>
<li>Show "Empty State" Illustration.</li>
<li>Text: "We couldn't find any regions matching 'Mars'."</li>
<li>Button: "Clear Search".</li>
</ul>
</li>
</ul>
</body>
</html>
